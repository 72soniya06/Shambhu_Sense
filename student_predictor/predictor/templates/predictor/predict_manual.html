{% extends "predictor/base.html" %}
{% block content %}
<!-- ðŸ§  Test Icon (Left Corner) -->
<a href="{% url 'test_page' %}"
   title="Take a Test"
   style="
     position: fixed;
     top: 20px;
     left: 20px; /* ðŸ‘ˆ left side pe shift */
     background-color: #007bff;
     color: white;
     border-radius: 50%;
     width: 55px;
     height: 55px;
     text-align: center;
     font-size: 26px;
     line-height: 55px;
     text-decoration: none;
     box-shadow: 0 4px 10px rgba(0,0,0,0.3);
     transition: 0.3s;
     z-index: 1000;
   "
   onmouseover="this.style.backgroundColor='#0056b3';"
   onmouseout="this.style.backgroundColor='#007bff';">
  ðŸ§ 
</a>


<h3 style="text-align:center; color:white; margin-bottom:8px;">ðŸŒž Todayâ€™s Motivation</h3>

<!-- ðŸŒŸ Motivation Box -->
<div style="
  background: white;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  max-width: 700px;
  margin: 0 auto 20px auto;
  padding: 15px 25px;
  text-align: center;
  transition: all 0.5s ease;
">
  <div id="motivation-content"
       style="font-size: 18px; font-weight: 500; color: #333; transition: opacity 1s; opacity: 1;">
    <!-- Quote will appear here -->
  </div>
</div>

<script>
const quotes = [
  { text: "ðŸ“š Believe in yourself! Every small effort adds up to success.", img: "https://cdn-icons-png.flaticon.com/512/616/616408.png" },
  { text: "ðŸš€ Keep pushing your limits â€“ your future self will thank you!", img: "https://cdn-icons-png.flaticon.com/512/814/814513.png" },
  { text: "ðŸŽ¯ Focus, study smart, and let success follow!", img: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png" },
  { text: "ðŸ’¡ Mistakes are proof that youâ€™re trying. Keep going!", img: "https://cdn-icons-png.flaticon.com/512/616/616409.png" },
  { text: "ðŸ”¥ Hard work beats talent when talent doesnâ€™t work hard!", img: "https://cdn-icons-png.flaticon.com/512/616/616408.png" },
  { text: "ðŸŒˆ Every day is a new chance to learn something great!", img: "https://cdn-icons-png.flaticon.com/512/616/616554.png" }
];

let index = Math.floor(Math.random() * quotes.length);
const contentDiv = document.getElementById("motivation-content");

function showQuote() {
  const q = quotes[index];
  contentDiv.style.opacity = 0;
  setTimeout(() => {
    contentDiv.innerHTML = `
      <img src="${q.img}" alt="motivation" width="40"
           style="vertical-align:middle; margin-right:10px;">
      ${q.text}
    `;
    contentDiv.style.opacity = 1;
  }, 500);

  index = (index + 1) % quotes.length;
}

// Show first quote immediately
showQuote();

// Rotate quote every 5 seconds
setInterval(showQuote, 5000);
</script>

<!-- Stylish Heading Box -->
<div style="
  background: white;
  padding: 12px 20px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  text-align: center;
  max-width: 400px;
  margin: 0 auto 25px auto;
">
  <h2 style="margin: 0; color: #333;">
    ðŸŽ“ Manual Student Prediction
  </h2>
</div>


<form method="post" id="predictForm">
  {% csrf_token %}

  {{ form.as_p }}

  <button type="submit" style="
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;">
    ðŸ”® Predict
  </button>
</form>

{% if messages %}
  <ul class="messages" style="color: red; margin-top: 15px;">
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}


<hr>

<a href="{% url 'predict_csv' %}" style="margin-right:10px;">ðŸ“‚ Predict from CSV file</a>
<a href="{% url 'logout' %}">ðŸšª Logout</a>

<!-- ðŸ§  Category Toggle Script -->
<script>
function toggleCategoryFields() {
    const categorySelect = document.getElementById("id_category");
    if (!categorySelect) return;

    const category = categorySelect.value;
    const schoolFields = ["id_school_class", "id_percentage"];
    const collegeFields = ["id_course", "id_course_year", "id_cgpa"];

    function toggleFields(fields, display) {
        fields.forEach(id => {
            const el = document.getElementById(id);
            if (el && el.closest("p")) {
                el.closest("p").style.display = display;
            }
        });
    }

    if (category === "school") {
        toggleFields(schoolFields, "block");
        toggleFields(collegeFields, "none");
    } else if (category === "college") {
        toggleFields(schoolFields, "none");
        toggleFields(collegeFields, "block");
    }
}

document.addEventListener("DOMContentLoaded", function() {
    toggleCategoryFields();
    const categorySelect = document.getElementById("id_category");
    if (categorySelect) {
        categorySelect.addEventListener("change", toggleCategoryFields);
    }
});
</script>

<!-- ðŸ¤– Chatbot Icon + Popup -->
<style>
#chatbot-icon {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background-color: #4CAF50;
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    text-align: center;
    font-size: 30px;
    line-height: 60px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: all 0.3s;
}
#chatbot-icon:hover { background-color: #3e8e41; }

#chatbot-window {
    position: fixed;
    bottom: 90px;
    right: 25px;
    width: 320px;
    height: 400px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    display: none;
    flex-direction: column;
    overflow: hidden;
}

#chat-header {
    background-color: #4CAF50;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: bold;
}

#chat-messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    font-size: 14px;
}

#chat-input-box {
    display: flex;
    border-top: 1px solid #ccc;
}

#chat-input {
    flex: 1;
    border: none;
    padding: 10px;
    outline: none;
}

#send-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
}
</style>

<a href="{% url 'chatbot' %}" id="chatbot-icon" style="
    position: fixed;
    bottom: 25px;
    right: 25px;
    background-color: #4CAF50;
    color: white;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    text-align: center;
    font-size: 30px;
    line-height: 60px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: all 0.3s;
    text-decoration: none;
">ðŸ’¬</a>


<div id="chatbot-window">
  <div id="chat-header">Shambhu AI Assistant</div>
  <div id="chat-messages">
    <p><b>ðŸ¤–:</b> Hi! I'm Shambhu AI. Ask anything about your studies or performance.</p>
  </div>
  <div id="chat-input-box">
    <input type="text" id="chat-input" placeholder="Type your question..." />
    <button id="send-btn">Send</button>
  </div>
</div>

<script>
const chatbotIcon = document.getElementById("chatbot-icon");
const chatbotWindow = document.getElementById("chatbot-window");
const sendBtn = document.getElementById("send-btn");
const chatInput = document.getElementById("chat-input");
const chatMessages = document.getElementById("chat-messages");

chatbotIcon.addEventListener("click", () => {
  chatbotWindow.style.display = chatbotWindow.style.display === "flex" ? "none" : "flex";
});

sendBtn.addEventListener("click", async () => {
  const userText = chatInput.value.trim();
  if (!userText) return;

  // show user message
  const userMsg = document.createElement("p");
  userMsg.innerHTML = `<b>You:</b> ${userText}`;
  chatMessages.appendChild(userMsg);
  chatInput.value = "";

  // show loading
  const aiMsg = document.createElement("p");
  aiMsg.innerHTML = `<b>ðŸ¤–:</b> Thinking...`;
  chatMessages.appendChild(aiMsg);

  try {
    const response = await fetch("/chatbot_api/", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-CSRFToken": "{{ csrf_token }}",
      },
      body: new URLSearchParams({ message: userText }),
    });

    const data = await response.json();

    if (data.answer) {
      aiMsg.innerHTML = `<b>ðŸ¤–:</b> ${data.answer}`;
    } else {
      aiMsg.innerHTML = `<b>ðŸ¤–:</b> Error: ${data.error || "Unknown error"}`;
    }
  } catch (err) {
    aiMsg.innerHTML = `<b>ðŸ¤–:</b> Network Error: ${err.message}`;
  }

  chatMessages.scrollTop = chatMessages.scrollHeight;
});
</script>
{% if result %}
<div style="margin-top:20px; background:#f0fff4; border:2px solid #4CAF50; border-radius:10px; padding:15px;">
  <h3>ðŸŽ¯ Predicted Final Grade: <span style="color:#2e7d32;">{{ result }}</span></h3>
  <p><b>ðŸ’¡ Study Tips:</b> {{ tips }}</p>
</div>
{% endif %}
<style>
/* --- Uniform Input Box Style --- */
form p {
  width: 100%;
  max-width: 500px; /* sab boxes ki same width */
  margin: 10px auto;
}

form label {
  display: block;
  font-weight: 600;
  margin-bottom: 6px;
  color: #333;
}

form input, form select {
  width: 100% !important;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
  box-sizing: border-box;
  transition: all 0.3s ease;
}

form input:focus, form select:focus {
  outline: none;
  border-color: #6a5acd;
  box-shadow: 0 0 5px rgba(106, 90, 205, 0.4);
}
</style>

{% endblock %}

